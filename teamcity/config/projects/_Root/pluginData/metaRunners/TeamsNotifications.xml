<?xml version="1.0" encoding="UTF-8"?>
<meta-runner name="Teams Notifications">
  <description>Notifies action to a teams channel using webhooks</description>
  <settings>
    <parameters>
      <param name="NOTIFICATION_IMAGE" value="https://www.sideshowtoy.com/photo.php?sku=902662\" />
      <param name="TEAMS_WEBHOOK" value="" />
    </parameters>
    <build-runners>
      <runner name="Teams notification" type="simpleRunner">
        <parameters>
          <param name="script.content"><![CDATA[curl -H "Content-Type: application/json" -d "{\
\"@type\": \"MessageCard\",\
\"@context\": \"http://schema.org/extensions\",\
\"themeColor\": \"B2D233\",\
\"summary\": \"%system.teamcity.buildType.id% release\",\
\"sections\": [{\
    \"activityTitle\": \"%system.teamcity.buildType.id% %build.number% was deployed\",\
    \"activitySubtitle\": \"Environment: %system.teamcity.projectName%\",\
    \"activityImage\": \"%NOTIFICATION_IMAGE%",\
    \"activityText\": \"[Go to result](https://teamcity.veinteractive.net/viewLog.html?buildId=%teamcity.build.id%&tab=buildResultsDiv)\",\
    \"facts\": [{\
        \"name\": \"Triggered by\",\
        \"value\": \"%teamcity.build.triggeredBy%\"\
    }, {\
        \"name\": \"Status\",\
        \"value\": \"OK\"\
    }],\
    \"markdown\": true\
}]\
}" %TEAMS_WEBHOOK%]]></param>
          <param name="teamcity.step.mode" value="default" />
          <param name="use.custom.script" value="true" />
        </parameters>
      </runner>
    </build-runners>
    <requirements />
  </settings>
</meta-runner>

